# PhotoWatermark-AI4SE 迭代二需求文档

## 项目概述
PhotoWatermark-AI4SE 是一款用于给图片添加水印的GUI应用程序，支持文本和图片水印，具有丰富的自定义功能和实时预览。此版本专注于Windows平台，并将发布为可执行文件。

## 功能需求

### 1. 文件处理

#### 1.1 导入图片
- 支持单张图片拖拽或通过文件选择器导入
- 支持批量导入，可一次性选择多张图片或直接导入整个文件夹
- 在界面上显示已导入图片的列表（缩略图和文件名）

#### 1.2 支持格式
- **输入格式**：必须支持主流格式，如 JPEG, PNG；强烈建议支持 BMP, TIFF；PNG格式必须支持透明通道
- **输出格式**：用户可选择输出为 JPEG 或 PNG

#### 1.3 导出图片
- 用户可指定一个输出文件夹；为防止覆盖原图，默认禁止导出到原文件夹
- 提供导出文件命名规则选项：
  - 保留原文件名
  - 添加自定义前缀（如 wm_）
  - 添加自定义后缀（如 _watermarked）
- 对于 JPEG 格式，提供图片质量（压缩率）调节滑块（0-100）（可选高级功能）
- 导出时允许用户调整图片尺寸（如按宽度、高度或百分比缩放）（可选高级功能）

### 2. 水印类型

#### 2.1 文本水印
- **内容**：用户可自定义输入任意文本
- **字体**：可选择系统已安装的字体、字号、粗体、斜体（可选高级功能）
- **颜色**：提供调色板让用户选择字体颜色（可选高级功能）
- **透明度**：可调节文本的透明度（0-100%）
- **样式**：可添加阴影或描边效果，以增强在复杂背景下的可读性（可选高级功能）

#### 2.2 图片水印（可选高级功能）
- 用户可从本地选择一张图片（如Logo）作为水印
- 必须支持带透明通道的 PNG 图片
- **缩放**：可按比例或自由调整图片水印的大小
- **透明度**：可调节图片水印的整体透明度（0-100%）

### 3. 水印布局与样式

#### 3.1 实时预览
- 所有对水印的调整都应在主预览窗口中实时显示效果
- 用户可以点击图片列表切换预览不同的图片

#### 3.2 位置
- **预设位置**：提供九宫格布局（四角、正中心），用户可一键将水印放置在这些位置
- **手动拖拽**：用户可以直接在预览图上通过鼠标拖拽水印到任意位置

#### 3.3 旋转（可选高级功能）
- 提供一个滑块或输入框，允许用户以任意角度旋转水印

### 4. 配置管理

#### 4.1 水印模板
- 用户可以将当前的水印设置（包括水印内容、字体、颜色、位置、大小、透明度等所有参数）保存为一个模板
- 用户可以加载、管理和删除已保存的模板
- 程序启动时可自动加载上一次关闭时的设置或一个默认模板

## 非功能需求

### 1. 用户体验
- 界面应直观易用，符合Windows桌面应用程序的常见交互模式
- 提供实时预览功能，让用户能够立即看到修改效果
- 操作应流畅，响应时间不超过1秒

### 2. 性能
- 应能处理大尺寸图片，支持常见的图片分辨率
- 批量处理时应提供进度指示器

### 3. 平台兼容性
- 仅支持Windows平台（Windows 7, 8, 10, 11）
- 应使用与Windows系统兼容的文件路径和系统调用

### 4. 错误处理
- 应对文件格式错误、文件损坏等情况提供适当的错误提示
- 对于用户误操作（如导出到原文件夹）应提供确认对话框

## 发布和部署需求

### 1. Windows可执行文件
- 应将应用程序打包为单个可执行文件（.exe）
- 可执行文件应该能在没有安装Python的Windows系统上独立运行
- 推荐使用PyInstaller或cx_Freeze进行打包

### 2. 依赖管理
- 所有依赖项应包含在可执行文件中
- 应确保在目标Windows系统上运行时没有缺失库的问题

### 3. 安装包（可选）
- 考虑创建安装向导（.msi或.exe安装程序）
- 包含标准的Windows安装选项（安装路径、开始菜单快捷方式等）

## 技术考虑

### 1. GUI框架
- 使用tkinter（内置，无额外依赖）或PyQt5/6
- 考虑界面在Windows系统上的兼容性和外观一致性

### 2. 图片处理库
- 延续现有的Pillow库，或考虑使用OpenCV以支持更多功能

### 3. 数据存储
- 配置管理需要设计适当的模板保存格式（如JSON或XML）
- 需要管理用户设置的持久化存储

### 4. Windows特定需求
- 考虑Windows文件路径的兼容性（反斜杠 vs 正斜杠）
- 考虑UAC（用户访问控制）可能造成的问题
- 考虑防病毒软件可能将可执行文件误判为恶意软件